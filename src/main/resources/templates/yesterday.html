<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head th:replace="~{fragments/common.html :: frg_head}"></head>
<body>
<div id="yesterday-container" class="container-fluid p-0">
  <div th:replace="~{fragments/common.html :: frg_navbar}"></div>
  <div id="search-condition" class="input-group mb-3 mt-3 mt-md-0 w-100">
    <select id="location" class="form-control mx-2 rounded" ></select>
    <input type="date" class="form-control mx-2 rounded" >
  </div>
  <div id="first-row" class="row w-100 mb-3 justify-content-between">
      <div id="temperatureSheet-container" class="col-md-8 p-0 rounded">
        <div id="temperatureSheet" ></div>
      </div>
      <div class="col-md-3 p-0 rounded">

      </div>
  </div>
  <div class="row w-100 h-40 justify-content-between">
      <div class="col-md-6 p-0  rounded"></div>
      <div class="col-md-5 p-0  rounded"></div>
  </div>
</div>

<script th:replace="~{fragments/common.html :: script}"></script>
<script>

    const searchCondition = document.getElementById('search-condition');
    const where = document.querySelector('#search-condition select');
    const when = document.querySelector('input[type=\'date\']');
    let temperatureSheet;
    document.addEventListener('DOMContentLoaded', function (){
        init();
        <!-- 모바일 메뉴 클릭 시 display:block되도록 -->
        document.querySelector('.navbar-toggler').addEventListener('click', function(){
            document.querySelector('#navbarNav').classList.add('d-block');
        });

        searchCondition.addEventListener('change', function(e){
           if(where.value && when.value){
                const fcstData = doAction('getForecast');
                const weatherData = doAction('getWeather');
                if(fcstData&&weatherData){
                    if(temperatureSheet) temperatureSheet.destroy();
                    const series = [];

                    const fcstTmp = {
                        name:"예보기온",
                        data:[],
                    };

                    const fcstSize = fcstData.length;
                    for (let i = 0; i < fcstSize; i++) {
                        fcstTmp.data.push(Number(fcstData[i].tmp));
                    }

                    const weatherTmp = {
                        name:"관측기온",
                        data:[],
                    };

                    const weatherSize = weatherData.length;
                    for (let i = 0; i < weatherSize; i++) {
                        weatherTmp.data.push(Number(weatherData[i].tmp));
                    }

                    series.push(fcstTmp);
                    series.push(weatherTmp);

                    setChart(series);
                }
            }
        });
    });

    function init(){
        const selectedMenu = document.querySelectorAll('.menu-1');
        selectedMenu[0].classList.add('text-warning');
        selectedMenu[1].classList.add('text-warning');
        Util.setForm();
        setChart(null);
    }

    function doAction(sAction){
        if(sAction == 'getForecast'){
            const param = {}
            param.method = "GET";
            param.url = "/forecast/"+Util.removeMinusChar(when.value)+"/"+Number(where.value);
            param.async = false;
            const fcstData = Util.getAjax(param, null);
            return fcstData;
        }else if(sAction == 'getWeather'){
            const param = {}
            param.method = "GET";
            param.url = "/weather/"+Util.removeMinusChar(when.value)+"/"+Number(where.value);
            param.async = false;
            const weatherData = Util.getAjax(param, null);
            return weatherData;
        }
    }

    function setChart(series){
        const chartWidth = document.getElementById('temperatureSheet-container').clientWidth;
        const chartHeight = document.getElementById('temperatureSheet-container').clientHeight;
        temperatureSheet = toastui.Chart.lineChart({
            el : document.getElementById('temperatureSheet'),
            data :{
                    categories: [
                        '06시',
                        '12시',
                        '15시',
                        '18시',
                        '21시',
                        '23시',
                    ],
                    series: (series)?series:[],
            },

            options : {

                chart: {
                    width:Number(chartWidth) * 0.9,
                    height:Number(chartHeight),
                },

                legend: {
                    visible: false,
                },

                tooltip: {
                    formatter: (value) => `${value}°`,
                },

                exportMenu: {
                    visible: false
                },

                xAxis: {
                    label: {
                        interval: 1,
                    },
                    tick: {
                        interval: 1,
                    },
                    title: {
                        offsetX: 0,
                        offsetY: 0,
                        visible:false,
                    },
                },

                yAxis: {
                    label: {
                        interval: 1,
                    },
                },

                theme: {
                    chart: {
                        fontFamily: 'Malgun Gothic',
                        backgroundColor: 'rgba(255, 255, 255, 0)',
                    },

                    legend: {
                        label: {
                            fontFamily: 'GothicA1-Light',
                            fontSize: 12,
                            color: 'rgb(255, 255, 255)',
                        }
                    },

                    xAxis: {
                        label: {
                            fontFamily: 'GothicA1-Light',
                            fontWeight:'bold',
                            fontSize: 12,
                            color: 'white'
                        },
                        color:'white',
                        width: '3',
                    },

                    yAxis: {
                        label: {
                            fontFamily: 'GothicA1-Light',
                            fontWeight:'bold',
                            fontSize: 12,
                            color: 'white'
                        },
                        color:'white',
                        width: '3',
                    },

                },

                series: {
                    spline: true,
                },

            },
        });
    }


</script>
</body>
</html>